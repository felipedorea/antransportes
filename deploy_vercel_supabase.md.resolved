# üöÄ Guia de Deploy ‚Äî Vercel + Supabase

Guia completo para hospedar o site **FS Brothers Airlines** no **Vercel** com banco de dados **Supabase** (PostgreSQL).

---

## Pr√©-requisitos

- Conta no [GitHub](https://github.com) (reposit√≥rio do projeto j√° configurado)
- Conta no [Vercel](https://vercel.com)
- Conta no [Supabase](https://supabase.com)

---

## Passo 1 ‚Äî Configurar o Supabase

### 1.1 Criar o Projeto

1. Acesse [supabase.com](https://supabase.com) e fa√ßa login.
2. Clique em **"New Project"**.
3. Preencha:
   - **Name**: `fsbrothers` (ou o nome que preferir)
   - **Database Password**: Anote essa senha! Voc√™ vai precisar dela.
   - **Region**: Escolha a mais pr√≥xima (ex: `South America (S√£o Paulo)`)
4. Clique em **"Create new project"** e aguarde a inicializa√ß√£o (~2 min).

### 1.2 Obter a Connection String

1. No painel do Supabase, v√° em **Settings** ‚Üí **Database**.
2. Na se√ß√£o **"Connection string"**, selecione a aba **URI**.
3. Copie a string de conex√£o. Ela ser√° algo assim:

```
postgresql://postgres.[SEU-PROJECT-REF]:[SUA-SENHA]@aws-0-sa-east-1.pooler.supabase.com:6543/postgres
```

> [!IMPORTANT]
> Substitua `[SUA-SENHA]` pela senha que voc√™ definiu ao criar o projeto.

> [!TIP]
> Use a porta **`6543`** (modo **Transaction** / pooler) para melhor compatibilidade com serverless (Vercel).
> Se encontrar problemas de conex√£o, tente a porta `5432` (conex√£o direta).

### 1.3 Adicionar `?pgbouncer=true` (Recomendado)

Para evitar problemas de conex√£o em ambientes serverless, adicione `?pgbouncer=true` ao final da URL:

```
postgresql://postgres.[REF]:[SENHA]@aws-0-sa-east-1.pooler.supabase.com:6543/postgres?pgbouncer=true
```

---

## Passo 2 ‚Äî Preparar o Reposit√≥rio

### 2.1 Garantir que o `build` gera o Prisma Client

Abra o [package.json](file:///c:/Users/Felipe/Documents/GitHub/antransportes/package.json) e adicione o script `postinstall`:

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "postinstall": "prisma generate"
  }
}
```

> [!IMPORTANT]
> O `postinstall` garante que o Prisma Client seja gerado automaticamente no Vercel durante o `npm install`.

### 2.2 Criar o arquivo [.env.local](file:///c:/Users/Felipe/Documents/GitHub/antransportes/.env.local) (Opcional, apenas para testes locais)

> [!CAUTION]
> **Nunca** fa√ßa commit do [.env.local](file:///c:/Users/Felipe/Documents/GitHub/antransportes/.env.local) no Git. Ele cont√©m credenciais sens√≠veis.

```env
DATABASE_URL="postgresql://postgres.[REF]:[SENHA]@aws-0-sa-east-1.pooler.supabase.com:6543/postgres?pgbouncer=true"
JWT_SECRET="uma-chave-secreta-bem-longa-e-aleatoria-aqui"
```

### 2.3 Fazer Push do C√≥digo

```bash
git add .
git commit -m "Preparar para deploy no Vercel"
git push origin main
```

---

## Passo 3 ‚Äî Aplicar o Schema no Supabase

Antes de fazer o deploy, voc√™ precisa criar as tabelas no banco do Supabase.

### 3.1 Rodar o `prisma db push`

No terminal local, execute:

```bash
set DATABASE_URL=postgresql://postgres.[REF]:[SENHA]@aws-0-sa-east-1.pooler.supabase.com:5432/postgres
npx prisma db push
```

> [!NOTE]
> Para o `db push`, use a porta **`5432`** (conex√£o direta), n√£o a `6543`.
> O `db push` precisa de uma conex√£o direta para aplicar altera√ß√µes no schema.

### 3.2 Rodar o Seed (Dados Iniciais)

```bash
set DATABASE_URL=postgresql://postgres.[REF]:[SENHA]@aws-0-sa-east-1.pooler.supabase.com:5432/postgres
npx prisma db seed
```

Isso ir√° criar:
- ‚úÖ Usu√°rio admin (`admin@fsbrothers.com.br` / senha: `admin`)
- ‚úÖ Pilotos de exemplo
- ‚úÖ Rotas de exemplo
- ‚úÖ Liveries e Apps de exemplo

> [!WARNING]
> A senha padr√£o do seed √© `admin`. **Troque imediatamente** ap√≥s o primeiro login em produ√ß√£o via o painel de Configura√ß√µes.

---

## Passo 4 ‚Äî Deploy no Vercel

### 4.1 Importar o Projeto

1. Acesse [vercel.com/new](https://vercel.com/new).
2. Clique em **"Import Git Repository"**.
3. Selecione o reposit√≥rio `antransportes` do GitHub.
4. Clique em **"Import"**.

### 4.2 Configurar Vari√°veis de Ambiente

Na tela de configura√ß√£o do projeto, v√° em **Environment Variables** e adicione:

| Vari√°vel | Valor | Descri√ß√£o |
|:---|:---|:---|
| `DATABASE_URL` | `postgresql://postgres.[REF]:[SENHA]@...pooler.supabase.com:6543/postgres?pgbouncer=true` | Conex√£o com o banco Supabase (usar porta 6543) |
| `JWT_SECRET` | `gere-uma-string-aleatoria-com-32+-caracteres` | Chave secreta para tokens de autentica√ß√£o |

> [!TIP]
> Para gerar um `JWT_SECRET` seguro, execute no terminal:
> ```bash
> node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
> ```

### 4.3 Build Settings

O Vercel deve detectar automaticamente o Next.js. Confirme que as configura√ß√µes est√£o assim:

| Campo | Valor |
|:---|:---|
| **Framework Preset** | Next.js |
| **Build Command** | `next build` (padr√£o) |
| **Output Directory** | `.next` (padr√£o) |
| **Install Command** | `npm install` (padr√£o) |

### 4.4 Deploy

Clique em **"Deploy"** e aguarde. O processo leva cerca de 1‚Äì3 minutos.

---

## Passo 5 ‚Äî Verifica√ß√£o P√≥s-Deploy

### 5.1 Testar o Site

1. Acesse a URL fornecida pelo Vercel (ex: `https://seu-projeto.vercel.app`)
2. Verifique:
   - ‚úÖ P√°gina inicial carrega com o v√≠deo de fundo
   - ‚úÖ Navbar com fontes brancas no topo, escurecendo ao rolar
   - ‚úÖ Se√ß√£o de equipe exibe os pilotos na ordem correta
   - ‚úÖ Footer exibe links din√¢micos (WhatsApp, Discord, Instagram)

### 5.2 Testar o Painel Admin

1. Acesse `https://seu-projeto.vercel.app/admin/login`
2. Fa√ßa login com `admin@fsbrothers.com.br` / `admin`
3. Verifique:
   - ‚úÖ Sidebar fixa e occupando toda a altura
   - ‚úÖ Gerenciamento de Pilotos, Rotas, Liveries, Mods, Apps funcional
   - ‚úÖ Se√ß√£o "Links & Redes" salva e atualiza os links nas p√°ginas p√∫blicas

---

## Passo 6 ‚Äî Dom√≠nio Personalizado (Opcional)

1. No painel do Vercel, v√° em **Settings** ‚Üí **Domains**.
2. Clique em **"Add Domain"**.
3. Digite seu dom√≠nio (ex: `fsbrothers.com.br`).
4. Siga as instru√ß√µes para configurar os registros DNS:
   - **Tipo A**: `76.76.21.21`
   - **Tipo CNAME**: `cname.vercel-dns.com`
5. Aguarde a propaga√ß√£o DNS (pode levar at√© 48h, normalmente 15‚Äì30 min).

---

## Troubleshooting

### Erro: `PrismaClientInitializationError`
- Verifique se a `DATABASE_URL` est√° correta nas vari√°veis de ambiente do Vercel.
- Certifique-se de usar a porta `6543` com `?pgbouncer=true`.

### Erro: `Cannot find module '.prisma/client'`
- Confirme que o script `postinstall` est√° no [package.json](file:///c:/Users/Felipe/Documents/GitHub/antransportes/package.json).
- Fa√ßa um redeploy no Vercel.

### Erro: `connect ECONNREFUSED` ou timeout
- Verifique se o IP do Vercel n√£o est√° bloqueado no Supabase.
- No Supabase, v√° em **Settings** ‚Üí **Database** ‚Üí **Network** e garanta que "Allow all IPs" esteja habilitado (ou adicione os IPs do Vercel).

### Build falha com erros de TypeScript
- Execute `npm run build` localmente para identificar os erros antes do deploy.
- Corrija os erros e fa√ßa push novamente.

### Admin n√£o consegue logar
- Verifique se o seed foi executado (`npx prisma db seed`).
- Confira se a `JWT_SECRET` est√° configurada no Vercel.

---

## Resumo das Vari√°veis de Ambiente

| Vari√°vel | Obrigat√≥ria | Descri√ß√£o |
|:---|:---|:---|
| `DATABASE_URL` | ‚úÖ Sim | Conex√£o PostgreSQL do Supabase |
| `JWT_SECRET` | ‚úÖ Sim | Chave secreta para autentica√ß√£o JWT |

---

> [!NOTE]
> Ap√≥s o deploy, qualquer push para a branch [main](file:///c:/Users/Felipe/Documents/GitHub/antransportes/prisma/seed.js#6-63) no GitHub far√° um **redeploy autom√°tico** no Vercel.
